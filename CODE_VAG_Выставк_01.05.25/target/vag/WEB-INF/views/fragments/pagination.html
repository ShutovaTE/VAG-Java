<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>
    <div th:fragment="pagination(page, url)" class="pagination" th:if="${page.totalPages > 1}">
        <!-- Previous page arrow -->
        <a th:if="${page.hasPrevious()}"
           th:href="@{${url}(page=${page.number - 1}, size=${page.size})}"
           class="pagination-arrow" title="Предыдущая страница">&laquo;</a>

        <!-- Numbered pages -->
        <th:block th:with="currentPage=${page.number + 1},
                           totalPages=${page.totalPages},
                           maxVisible=5">
            
            <!-- Simple approach for all cases -->
            <th:block th:if="${totalPages <= maxVisible}">
                <!-- Display all pages when total pages ≤ 5 -->
                <th:block th:each="i : ${#numbers.sequence(1, totalPages)}">
                    <a th:if="${i != currentPage}"
                       th:href="@{${url}(page=${i - 1}, size=${page.size})}"
                       th:text="${i}"></a>
                    <span th:if="${i == currentPage}" 
                          class="current-page" 
                          th:text="${i}"></span>
                </th:block>
            </th:block>

            <th:block th:if="${totalPages > maxVisible}">
                <!-- Display first page (always) -->
                <th:block th:if="${currentPage != 1}">
                    <a th:href="@{${url}(page=0, size=${page.size})}" th:text="1"></a>
                </th:block>
                <th:block th:if="${currentPage == 1}">
                    <span class="current-page" th:text="1"></span>
                </th:block>

                <!-- Display ellipsis after first page if needed -->
                <th:block th:if="${currentPage > 3}">
                    <span class="pagination-ellipsis">...</span>
                </th:block>
                
                <!-- Calculate middle pages range -->
                <th:block th:with="
                    startPage=${currentPage <= 3 ? 2 : (currentPage >= totalPages - 2 ? totalPages - 4 : currentPage - 1)},
                    endPage=${currentPage <= 3 ? (totalPages < 6 ? totalPages - 1 : 5) : (currentPage >= totalPages - 2 ? totalPages - 1 : currentPage + 1)}">
                    
                    <!-- Ensure valid range -->
                    <th:block th:if="${startPage <= endPage && startPage >= 2}">
                        <th:block th:each="i : ${#numbers.sequence(startPage, endPage)}">
                            <!-- Avoid duplicating first and last page -->
                            <th:block th:if="${i != 1 && i != totalPages}">
                                <a th:if="${i != currentPage}"
                                   th:href="@{${url}(page=${i - 1}, size=${page.size})}"
                                   th:text="${i}"></a>
                                <span th:if="${i == currentPage}" 
                                      class="current-page" 
                                      th:text="${i}"></span>
                            </th:block>
                        </th:block>
                    </th:block>
                </th:block>
                
                <!-- Display ellipsis before last page if needed -->
                <th:block th:if="${currentPage < totalPages - 2}">
                    <span class="pagination-ellipsis">...</span>
                </th:block>
                
                <!-- Display last page (always) -->
                <th:block th:if="${currentPage != totalPages}">
                    <a th:href="@{${url}(page=${totalPages - 1}, size=${page.size})}" th:text="${totalPages}"></a>
                </th:block>
                <th:block th:if="${currentPage == totalPages}">
                    <span class="current-page" th:text="${totalPages}"></span>
                </th:block>
            </th:block>
        </th:block>

        <!-- Next page arrow -->
        <a th:if="${page.hasNext()}"
           th:href="@{${url}(page=${page.number + 1}, size=${page.size})}"
           class="pagination-arrow" title="Следующая страница">&raquo;</a>
    </div>
</body>
</html> 